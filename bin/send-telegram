#!/usr/bin/env bash
# Usage: send-telegram "message text"
# Sends a message to the configured Telegram chat.
# Reads TELEGRAM_BOT_TOKEN and TELEGRAM_CHAT_ID from environment or ../.env
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

if [ -z "${TELEGRAM_BOT_TOKEN:-}" ] && [ -f "$SCRIPT_DIR/../.env" ]; then
    export $(grep -v '^\#' "$SCRIPT_DIR/../.env" | xargs)
fi

if [ -z "${TELEGRAM_BOT_TOKEN:-}" ] || [ -z "${TELEGRAM_CHAT_ID:-}" ]; then
    echo "ERROR: TELEGRAM_BOT_TOKEN and TELEGRAM_CHAT_ID required" >&2
    exit 1
fi

curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
    -d chat_id="${TELEGRAM_CHAT_ID}" \
    -d text="$1" > /dev/null
